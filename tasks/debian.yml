---
# tasks file for ansible-role-arc-client
#
- name: Apt install packages for arc-client
  ansible.builtin.apt:
    pkg: "{{ arc_deb_client_packages }}"
    state: present

- name: Template in fetch-crl.d config
  ansible.builtin.template:
    src: "fetch-crl.conf"
    dest: "/etc/fetch-crl.d/proxy.conf"
    mode: 0644
    owner: "root"
    group: "root"
    backup: false

- name: Template in /etc/vomses
  ansible.builtin.template:
    src: deb_vomses.j2
    dest: /etc/vomses
    mode: 0644
    owner: root
    group: root
    backup: true
  when: arc_manage_vomses | bool

- name: Start fetch-crl-cron
  ansible.builtin.service:
    name: fetch-crl-cron
    state: started
    enabled: true

- name: Add apt EGI trustanchors key
  ansible.builtin.apt_key:
    url: https://dist.eugridpma.info/distribution/igtf/current/GPG-KEY-EUGridPMA-RPM-3
    state: present
  when: repo_egi_trustanchors | bool

- name: Add apt EGI Trustanchors REPO
  ansible.builtin.apt_repository:
    repo: 'deb http://repository.egi.eu/sw/production/cas/1/current egi-igtf core'
    state: present
  when: repo_egi_trustanchors | bool

- name: Apt install repo_egi_packages
  ansible.builtin.apt:
    name: "{{ repo_egi_deb_packages }}"
    state: present
  when: repo_egi_trustanchors | bool

- name: Template ARC client.conf with sensible defaults
  ansible.builtin.template:
    src: client.conf.j2
    dest: /etc/arc/client.conf
    owner: root
    group: root
    mode: 0644
  when: arc_client_conf | bool
